---
import PageLayout from "@/layouts/Base.astro";
import { Image } from "astro:assets";
import hills from "@/content/images/hills.jpg";
import lightsCropped from "@/content/images/Lights_Cropped.jpg";
import flags from "@/content/images/Flags.jpeg";
import { getCollection } from "astro:content";

// Import homepage data directly - Astro handles YAML natively
import homepage from "@/content/homepage.json";

// Get collections data
const problemCardsCollection = (await getCollection("problemCards")) || [];
const differentiatorsCollection =
  (await getCollection("differentiators")) || [];
const servicesCollection = (await getCollection("services")) || [];
const teamMembersCollection = (await getCollection("teamMembers")) || [];

// Sort collections by order
problemCardsCollection.sort(
  (a, b) => (a.data.order ?? 0) - (b.data.order ?? 0)
);
differentiatorsCollection.sort(
  (a, b) => (a.data.order ?? 0) - (b.data.order ?? 0)
);
servicesCollection.sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0));
teamMembersCollection.sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0));

// Collections are already rendered with Astro v5+
const problemCards = problemCardsCollection;
const differentiators = differentiatorsCollection;
const services = servicesCollection;
const teamMembers = teamMembersCollection;

// Use the homepage data and fail loudly if it doesn't exist
if (!homepage) {
  throw new Error("Homepage data not found at src/content/homepage/index.yaml");
}

const content = homepage;
---

<PageLayout meta={{ title: "Home Page" }}>
  <!-- Hero image -->

  <section class="gc-full mt-28 mb-28">
    <h2 class="text-3xl
    md:text-4xl
    leading-snug">
      {content.heroTitle}
    </h2>
    <p class="text-sm leading-normal">
      {content.heroDescription}
    </p>
  </section>
  <section class="gc-full">
    <Image
      src={hills}
      alt="Rolling hills landscape"
      class="w-full h-60 object-cover object-top"
    />
  </section>

  <!-- Hero statement -->

  <!-- Two-column editorial with asymmetric spans -->
  <section class="gc-full grid-local mb-20">
    <article class="gc-full md:col-span-5 lg:col-span-10 mb-10">
      <h3 class="text-3xl md:text-4xl leading-snug">
        {content.mainProblemTitle}
      </h3>
      <p class="text-sm leading-normal">
        {content.mainProblemDescription}
      </p>
    </article>

    {
      problemCards.map((card) => (
        <section class="gc-full md:col-span-2 lg:col-span-3 md:border-t-[5px] md:border-black">
          <h4 class="text-xl">{card.data.title}</h4>
          <div
            class="text-sm leading-normal prose-sm prose-p:mb-0"
            set:html={card.rendered?.html}
          />
        </section>
      ))
    }
  </section>

  <!-- Lights image before differentiators -->
  <section class="gc-full -mb-4">
    <Image
      src={lightsCropped}
      alt="Lights cropped image"
      class="w-full h-72 object-cover object-center"
    />
  </section>

  <!-- Differentiation -->
  <section class="gc-full grid-local bg-black text-white">
    <article class="gc-full md:col-span-2 lg:gc-third py-5 px-5">
      <h3 class="text-3xl md:text-4xl leading-snug mb-4">
        {content.differentiatorTitle}
      </h3>
    </article>
    <div class="gc-full md:gc-two-thirds lg:gc-two-thirds py-5 px-5">
      {
        differentiators.map((diff) => (
          <section class="mb-8 last:mb-0">
            <h4 class="text-xl mb-3">{diff.data.title}</h4>
            <div
              class="text-sm leading-normal prose-sm prose-p:mb-0"
              set:html={diff.rendered?.html}
            />
          </section>
        ))
      }
    </div>
  </section>

  <!-- About Us -->
  <section class="gc-full grid-local-10 mt-20">
    <section class="gc-full mt-4 mb-10">
      <h3 class="text-3xl md:text-4xl leading-snug">
        {content.aboutUsTitle}
      </h3>
      <p class="text-sm leading-normal">
        {content.aboutUsDescription}
      </p>
    </section>

    {
      teamMembers.map((member) => (
        <section class="gc-full md:col-span-3 lg:col-span-5 py-5 px-5 bg-gray-200">
          <h4 class="text-2xl mb-3">
            {member.data.name
              .replace("-", " ")
              .replace(/\b\w/g, (l) => l.toUpperCase())}
          </h4>
          <h5 class="text-lg mb-3 text-gray-600">{member.data.title}</h5>
          <div
            class="text-sm leading-normal prose-sm mb-4"
            set:html={member.rendered?.html}
          />
          <div class="text-sm leading-normal">
            <strong>Specializes in:</strong>
            <ul class="list-disc list-inside mt-2 space-y-1">
              {member.data.specializations.map((spec) => (
                <li>{spec}</li>
              ))}
            </ul>
          </div>
        </section>
      ))
    }
  </section>

  <!-- Flags image before services -->
  <section class="gc-full">
    <Image
      src={flags}
      alt="Flags image"
      class="w-full h-72 object-cover object-center"
    />
  </section>

  <!-- Services -->
  <section class="gc-full grid-local-10 gr-span-25">
    <section class="gc-full gr-span-2">
      <h3 class="text-3xl md:text-4xl leading-snug mt-20">
        {content.servicesTitle}
      </h3>
      <p class="text-sm leading-normal">
        {content.servicesSubtitle}
      </p>
    </section>

    {
      services.map((service) => (
        <section class="gc-full gr-span-6 md:col-span-3 lg:col-span-5 border-1 border-black py-5 px-5">
          <h4 class="text-2xl mb-3">{service.data.title}</h4>
          <div
            class="text-sm leading-normal prose-sm"
            set:html={service.rendered?.html}
          />
        </section>
      ))
    }

    <!-- <details class="group">
          <summary class="text-sm leading-normal cursor-pointer list-none">
            <span class="group-open:hidden">{content.servicesDescription}</span>
            <span class="hidden group-open:inline"
              >Click to collapse description</span
            >
          </summary>
          <div class="text-sm leading-normal mt-2">
            <p>
              This is additional content that expands when you click the summary
              above. You can put any server-rendered content here - paragraphs,
              lists, or even more complex markup.
            </p>
            <p>
              Since this is server-rendered, it works perfectly with Astro's
              static generation and doesn't require any JavaScript.
            </p>
          </div>
        </details> -->
  </section>

  <!-- Three-column problem sections -->
</PageLayout>
