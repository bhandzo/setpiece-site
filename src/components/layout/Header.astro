---
import { menuLinks } from "@/site.config";
import { siteConfig } from "../../site.config";
---

<header class="group gc-full grid-local" id="main-header">
  <!-- Logo/Brand - Left -->
  <div class="gc-third md:gc-third md:gc-start-1">
    <a
      aria-current={Astro.url.pathname === "/" ? "page" : false}
      class="inline-block hover:text-accent transition-colors"
      href="/"
    >
      <img
        src="/logo.svg"
        alt="Setpiece Logo"
        class="w-8 h-8 inline-block align-middle"
      />
      <span class="text-lg font-medium tracking-tight ml-2 align-middle"
        >{siteConfig.title}</span
      >
    </a>
  </div>

  <!-- Navigation - Center -->
  <nav
    aria-label="Main menu"
    class="gc-third md:gc-third md:gc-start-3"
    id="navigation-menu"
  >
    {
      menuLinks.map((link) => (
        <a
          aria-current={Astro.url.pathname === link.path ? "page" : false}
          class="text-sm uppercase tracking-wide hover:text-accent transition-colors leading-none"
          href={link.path}
        >
          {link.title}
        </a>
      ))
    }

    <!-- Mobile navigation -->
    <div class="md:hidden hidden group-[.menu-open]:block">
      <div class="pt-4 border-t border-ink/10">
        {
          menuLinks.map((link) => (
            <a
              aria-current={Astro.url.pathname === link.path ? "page" : false}
              class="block text-sm uppercase tracking-wide hover:text-accent transition-colors mb-2"
              href={link.path}
            >
              {link.title}
            </a>
          ))
        }
      </div>
    </div>
  </nav>

  <!-- Controls - Right -->
  <div class="md:gc-third md:gc-start-5">
    <!-- Mobile menu button -->
    <mobile-button>
      <button
        aria-expanded="false"
        aria-haspopup="menu"
        class="group relative h-6 w-6 md:hidden ml-auto"
        id="toggle-navigation-menu"
        type="button"
      >
        <span class="sr-only">Open main menu</span>
        <svg
          aria-hidden="true"
          class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
          fill="none"
          focusable="false"
          id="line-svg"
          stroke="currentColor"
          stroke-width="1.5"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M3.75 9h16.5m-16.5 6.75h16.5"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
        <svg
          aria-hidden="true"
          class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
          fill="none"
          focusable="false"
          id="cross-svg"
          stroke="currentColor"
          stroke-width="1.5"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M6 18L18 6M6 6l12 12"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </button>
    </mobile-button>
  </div>
</header>

<script>
  import { toggleClass } from "@/utils/domElement";

  class MobileNavBtn extends HTMLElement {
    #menuOpen: boolean = false;

    connectedCallback() {
      const headerEl = document.getElementById("main-header")!;
      const mobileButtonEl = this.querySelector<HTMLButtonElement>("button");

      mobileButtonEl?.addEventListener("click", () => {
        if (headerEl) toggleClass(headerEl, "menu-open");
        this.#menuOpen = !this.#menuOpen;
        mobileButtonEl.setAttribute("aria-expanded", this.#menuOpen.toString());
      });
    }
  }

  customElements.define("mobile-button", MobileNavBtn);
</script>
